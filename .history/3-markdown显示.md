# DevSpace 功能变更记录

## 3. Article Editor UI Enhancement (2024-07-29)

### 3.1 功能概述

对文章创建/编辑页面 (`create.html`) 进行了改进，移除了手动输入的"摘要"字段，并优化了 Markdown 编辑器和预览区域的布局与视觉效果。

### 3.2 已实现功能

- **移除摘要字段**: 删除了文章摘要的 `textarea` 输入框及其关联的标签和提示信息。未来的实现将自动从文章正文的第一段生成摘要。
- **UI 优化**: 
    - 增加了 Markdown 输入区域和实时预览区域之间的间距，改善布局。
    - 为实时预览区域添加了圆角和稍浅的边框，使其视觉效果更柔和。
- **代码调整**: 更新了 `create.html` 中的 JavaScript 代码，移除了对已删除摘要字段的引用。

### 3.3 技术实现

1. **前端修改 (`create.html`)**:
   - 删除了包含 `id="article-summary"` 的 `div.mb-3` 元素。
   - 在包含 Markdown 输入和预览的 `div.row` 上添加了 Bootstrap gutter 类 (`g-md-4`)。
   - 在 `#html-preview` 的 CSS 样式中添加了 `border-radius` 并调整了 `border-color`。
   - 在页面的 `<script>` 块中，注释或删除了与 `summaryInput` 相关的变量声明和使用。

### 3.4 后续计划

- **后端实现**: 需要修改 `ArticleService` 以在创建或更新文章时，自动提取文章内容的第一段（或前 N 个字符）作为摘要，并保存到数据库的 `summary` 字段。
- **文档更新**: 需要更新 `README.md` 和 `DOCUMENT.md` 中关于文章创建/编辑流程的描述，移除对摘要输入的说明，并更新 DTO 定义。

## 2. 文章目录功能 (2023-10-16)

### 2.1 功能概述

DevSpace 现在支持自动生成文章目录 (Table of Contents)，并在文章详情页的右侧边栏中显示。此功能通过分析文章中的标题 (h1-h6) 自动构建目录，并提供点击导航和滚动时高亮当前阅读位置的功能，极大地提升了长文章的阅读体验。

### 2.2 已实现功能

- **自动目录生成**: 根据文章中的标题标签 (h1-h6) 自动生成多级目录结构。
- **平滑滚动导航**: 点击目录项时，页面会平滑滚动到对应的标题位置。
- **阅读位置追踪**: 在页面滚动时，目录会自动高亮当前正在阅读的章节。
- **自适应显示**: 长目录支持滚动，且在小屏幕上会自动调整显示方式。
- **空目录处理**: 当文章没有标题时，会显示友好的提示信息。

### 2.3 技术实现

1. **前端实现**:
   - `toc.js`: 实现目录生成、滚动监听和高亮功能的核心脚本。
   - `toc.css`: 定义目录的样式，包括不同级别标题的缩进和高亮效果。
   - `detail.html`: 在侧边栏中添加目录容器，位于作者信息卡片下方。

2. **交互功能**:
   - 为文章中的标题自动生成 ID (如果没有)，用于锚点导航。
   - 使用事件委托管理目录项的点击事件，实现平滑滚动。
   - 通过 `debounce` 函数优化滚动监听的性能，减少不必要的计算。
   - 使用 `IntersectionObserver` API (或滚动位置计算) 确定当前阅读位置。

### 2.4 使用效果

当用户阅读包含多个标题的文章时，目录会自动出现在右侧边栏中，位于作者信息下方。用户可以：

- 通过目录快速了解文章的整体结构
- 点击目录项直接跳转到感兴趣的章节
- 在阅读过程中，看到当前章节在目录中被高亮，便于定位
- 在手机等小屏幕设备上，目录会自动适应屏幕大小

### 2.5 后续计划

- 可折叠功能: 为长文章添加目录折叠/展开功能，以节省空间。
- 用户设置: 允许用户自定义目录的显示样式和行为。
- 锚点分享: 优化锚点 URL 的分享功能，使分享特定章节更便捷。
- 打印优化: 改进打印时目录的显示方式。

## 1. Markdown 支持 (2023-10-15)

### 1.1 功能概述

DevSpace 现在支持使用 Markdown 编写文章，并在前端显示为格式化的 HTML 内容。该功能通过使用 flexmark-java 库在后端进行 Markdown 到 HTML 的转换实现，提供了更好的内容排版和阅读体验。

### 1.2 已实现功能

- **Markdown 解析器**: 使用 flexmark-java 库在后端对 Markdown 内容进行解析和转换。
- **扩展特性**: 支持多种 Markdown 扩展功能，如表格、删除线和自动链接。
- **内容分离**: 保留原始 Markdown 内容用于编辑，使用转换后的 HTML 用于显示。
- **Markdown 编辑器**: 在创建/编辑文章页面集成了 SimpleMDE 编辑器，提供实时预览功能。
- **样式优化**: 添加了专门的 CSS 样式表，优化 Markdown 生成的 HTML 内容的显示效果。

### 1.3 技术实现

1. **后端实现**:
   - `MarkdownUtil`: 提供 Markdown 到 HTML 的转换功能。
   - `ArticleServiceImpl`: 在 `convertToVO` 方法中集成 Markdown 转换。
   - `ArticleVO`: 添加 `rawContent` 字段用于存储原始 Markdown 内容。

2. **前端实现**:
   - `article/detail.js`: 直接使用后端返回的 HTML 内容进行显示。
   - `articles/create.html`: 使用 SimpleMDE 编辑器替代原来的富文本编辑器。

### 1.4 使用示例

**Markdown 编辑**:
```markdown
# 文章标题

这是一个 **粗体** 和 *斜体* 文本的示例。

## 子标题

- 列表项 1
- 列表项 2
  - 嵌套列表项

[链接示例](https://example.com)

![图片示例](https://example.com/image.jpg)

> 引用示例

```java
// 代码示例
public class Example {
    public static void main(String[] args) {
        System.out.println("Hello DevSpace!");
    }
}
```

**表格示例**:

| 名称 | 描述 |
|-----|-----|
| Java | 编程语言 |
| Spring | 框架 |
```

### 1.5 后续计划

- 编辑器增强: 添加更多 Markdown 扩展功能支持。
- 图片上传: 集成图片直接上传功能，简化 Markdown 中的图片插入流程。
- 代码高亮: 增强代码块的语法高亮显示效果。
